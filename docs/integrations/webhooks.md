---
description: This article explains how to configure and use Syskit Point's webhooks.
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import HttpMethod from '@site/src/components/HttpMethod';

# Webhooks

Webhooks are **push notifications sent by Syskit Point as HTTP requests to a registered webhook endpoint when an event occurs**.

To successfully enable webhooks in Syskit Point, you need to perform the following steps:

* **Register endpoint** to which Syskit Point will send notifications.
* **Obtain the signature key** and secure your endpoint.
  * It is recommended for your webhook handler to verify that the webhook requests are generated by Syskit Point.

:::info
You must set up an HTTP endpoint function that can accept webhook requests using a POST method. 
:::

## Registering a Webhook Endpoint with Syskit Point API

:::warning
**Please note!**\
The application used to access the webhooks endpoint needs to have the `Point.Admin` app role.
:::

To register a webhook endpoint via the Syskit Point API, you need to use the following POST request:

<HttpMethod method="POST" /> &#123;&#123;pointWebAppUrl&#125;&#125;/v1.0/webhooks/endpoints

### Headers

| Name          | Value              |
| ------------- | ------------------ |
| Content-Type  | `application/json` |
| Authorization | `Bearer <token>`   |

**Body**

| Name       | Type   | Description            |
| ---------- | ------ | ---------------------- |
| `endpoint` | string | Webhook endpoint URL   |
| `types`    | array  | Types of notifications |

<Tabs>
<TabItem value="example" label="Example">

```json
{
  "endpoint": "https://contoso.azurewebsites.net/api/Logger?code=o74oKsbrgHDI-RnekJXdbR3Fba7mZxEmJQNyCIpV6z-ZAzFuwnaWJg==",
  "types": [
    "*"
  ]
}
```
</TabItem>
</Tabs>

:::info
You can subscribe to all event types using the `*` symbol, as shown in the example.
:::

**Types**

Syskit Point can send the following types of events:

| Type                  | Description                                        |
| --------------------- | -------------------------------------------------- |
| ProvisioningStarted   | Triggered when the Provisioning process starts     |
| ProvisioningCompleted | Triggered when the Provisioning process completes. |
| ProvisioningFailed    | Triggered when the Provisioning process fails.     |

Below, you can find examples for all types:

<Tabs>
<TabItem value="provisioning-started" label="ProvisioningStarted">

```json
{
    "type": "ProvisioningStarted",
    "content": {
      "name": "Resource Name",
      "type": "MicrosoftTeams|SharePointSiteCollection|YammerCommunity|M365Group",
      "requestedOn": "2023-10-05T14:48:00",
      "requesterId": "235ec2cb-0767-40b3-a1de-4da2c42b19e9"
    },
    "meta": {
      "timeStamp": "2023-10-05T14:48:00",
      "idempotencyKey": "f9ac8355-ddd7-48a3-98fb-9d4142501510"
    }
}
```

</TabItem>
<TabItem value="provisioning-completed" label="ProvisioningCompleted">

```json
{
    "type": "ProvisioningCompleted",
    "content": {
      "name": "Resource Name",
      "type": "MicrosoftTeams|SharePointSiteCollection|YammerCommunity|M365Group",
      "url": "https://contoso.sharepoint.com/sites/resourcename",
      "microsoftId": "3b735b14-de6f-4cf8-adc6-da7eaccbdc31"
    },
    "meta": {
      "timeStamp": "2023-10-05T14:48:00",
      "idempotencyKey": "854d127b-95c2-4b5f-bb45-7813946dee72"
    }
}
```

</TabItem>
<TabItem value="provisioning-failed" label="ProvisioningFailed">

```json
{
    "type": "ProvisioningFailed",
    "content": {
      "name": "Resource Name",
      "type": "MicrosoftTeams|SharePointSiteCollection|YammerCommunity|M365Group",
      "error": "Error Message",
      "correlationId ": "f65cefa6-01b7-47d6-a2cb-9442d13dd535"
    },
    "meta": {
      "timeStamp": "2023-10-05T14:48:00",
      "idempotencyKey": "45285061-1288-4899-b108-ad06cfbbcf6f"
    }
}
```

</TabItem>
</Tabs>

### Response

Successful registration of the webhook endpoint results in a response status 200.

<Tabs>
<TabItem value="200" label="200">
```json
{
    Null
}
```
</TabItem>
</Tabs>

## Webhook Events

Syskit Point sends a POST request to the registered webhook endpoint URL.

The event object has the following body structure:

<Tabs>
<TabItem value="body" label="Body">
```json
{
    "type": "type",
    "content": {serializedContent},
    "meta": {
        "timeStamp": "timestamp",
        "idempotencyKey": "key"
    }
}
```
</TabItem>
</Tabs>

Each webhook event also sends two headers:

* **Signature**: Contains the message signature created using the hashing algorithm provided in the Algorithm header using a signature key.
* **Algorithm**: The hashing algorithm used to create the message signature.

## Signature Validation

To verify the notification was sent by Syskit Point:

* **Get the signature key via Syskit Point API**
* **Create a signature using the key** to compare with the signature in the received event object

To get the signature key, send the following GET request.

<HttpMethod method="GET" /> &#123;&#123;pointWebAppUrl&#125;&#125;/v1.0/options

### Response

A successful request results in a response status 200 and provides the Signature Authentication Key.

<Tabs>
<TabItem value="200" label="200">
```json
{
    "webhooksSignatureAuthenticationKey": "158b08cc-6a06-49f2-a724-2bc514fdcf1e"
}
```
</TabItem>
</Tabs>

### Create Signature

Below is the code example you can use to create the signature, which can then be compared with the one received in the event object to verify it was sent from Syskit Point.

```csharp
private static string generateSignature(string content, string authKey)
{
    var keyBytes = Encoding.UTF8.GetBytes(authKey);
    var payloadBytes = Encoding.UTF8.GetBytes(content);

    using var hmac = new HMACSHA256(keyBytes);
    var hashBytes = hmac.ComputeHash(payloadBytes);
    return Convert.ToBase64String(hashBytes);
}
```

## Get Webook Endpoints

To retrieve a list of all registered webhook endpoints, use the following GET request:

<HttpMethod method="GET" /> &#123;&#123;pointWebAppUrl&#125;&#125;/v1.0/webhooks/endpoints 

### Response

<Tabs>
<TabItem value="200" label="200">
```json
[
  {
    "endpoint": "https://contoso.azurewebsites.net/api/Logger?code=o74oKsbrgHDI-RnekJXdbR3Fba7mZxEmJQNyCIpV6z-ZAzFuwnaWJg==",
    "types": [
      *
    ]
  }
]
```
</TabItem>
</Tabs>

## Delete Webook Endpoints

To delete a registered webhook endpoint, use the following DELETE request: 

<HttpMethod method="DELETE" /> &#123;&#123;pointWebAppUrl&#125;&#125;/v1.0/webhooks/endpoints

Include the endpoint URL in the body of the request to identify which webhook endpoint should be deleted.

**Body**

| Name       | Type   | Description            |
| ---------- | ------ | ---------------------- |
| `endpoint` | string | Webhook endpoint URL   |

<Tabs>
<TabItem value="example" label="Example">
```json
{
  "endpoint": "https://contoso.azurewebsites.net/api/Logger?code=o74oKsbrgHDI-RnekJXdbR3Fba7mZxEmJQNyCIpV6z-ZAzFuwnaWJg==",
}
```
</TabItem>
</Tabs>

### Response

If the deletion was successful, the `204 No content` status code is returned.

If the endpoint is not found in Syskit Point, the `404 Not Found` status code is returned.

<Tabs>
<TabItem value="404" label="404">
```json
{
  "message": "An error has occurred.",
  "exceptionMessage": "WebhookEndpoint with id https://contoso.azurewebsites.net/api/Logger?code=o74oKsbrgHDI-RnekJXdbR3Fba7mZxEmJQNyCIpV6z-ZAzFuwnaWJg== not found.",
  "exceptionType": "SysKit.Point.Application.SeedWork.Exceptions.ResourceMissingException"
}
```
</TabItem>
</Tabs>

